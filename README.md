# RAG Telegram Bot (RU)

Минимальный MVP бота на aiogram 3.x, отвечающего только из локальной базы знаний (RAG + FAISS).

## Быстрый старт

1) Установите зависимости (Python 3.11+):
```
pip install -r requirements.txt
```

2) Подготовьте .env (см. .env.example):
```
TELEGRAM_BOT_TOKEN=...
OPENAI_API_KEY=...
ALLOWED_CHAT_IDS=12345,67890
ORG_NAME=ВашаКомпания
TOP_K=8
MAX_CTX_CHARS=6000
```

3) Положите файлы базы знаний (.md, .txt) в каталог `data/`.

Можно использовать подпапки для департаментов: `data/ops`, `data/hr`, `data/it`, `data/marketing` и др.

4) Постройте индекс:
```
python -m rag.index_build
```

5) Запустите бота:
```
python bot.py
```

## Команды
- /start — краткая справка и примеры вопросов
- /kb <запрос> — показать релевантные разделы с оценкой схожести
- /policy — политика работы бота
- /feedback <текст> — отправить фидбек (логируется)

## Политика
- Источники ответов — только локальная БЗ. Браузинг и скачивание из сети отключены.
- Если релевантного контекста нет — бот честно откажет и подскажет эскалацию.
- В каждом ответе — секция "Источник: …" (пути документов, 2–5 шт.).

## Логи
- Запросы: `logs/queries.csv` (timestamp, user, вопрос, источники, длина ответа, статус, has_attachment)
- Фидбек: `logs/feedback.csv`

## Настройки
- Редактируются через .env: модели, TOP_K, MAX_CTX_CHARS, ORG_NAME, whitelist (ALLOWED_CHAT_IDS)
